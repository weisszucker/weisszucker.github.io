# å•å‘æ•°æ®åŒæ­¥ä¹‹â€œæ¨æ‹‰ç»“åˆâ€

> 2024/09/01
> 
> é˜²å¾®æœæ¸ã€‚

## èƒŒæ™¯

åœ¨æ•°æ®éš”ç¦»çš„å¤šç¯å¢ƒåœºæ™¯ä¸­ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªç¯å¢ƒä¸­çš„æŸä¸ªçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦åŠæ—¶åŒæ­¥åˆ°å¦ä¸€ä¸ªç¯å¢ƒä¸­ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤šè¿›ç¨‹è½¯ä»¶æ¶æ„ä¸­ï¼Œä¸åŒè¿›ç¨‹é—´æ— æ³•å¤©ç„¶çš„å…±äº«å†…å­˜ä¸Šçš„å˜é‡ï¼Œå¾€å¾€éœ€è¦ä¸»åŠ¨åŒæ­¥çŠ¶æ€ï¼Œæ‰èƒ½ä¿è¯å„ä¸ªè¿›ç¨‹é—´æ•°æ®çš„ä¸€è‡´æ€§ã€‚

æœ¬æ–‡ä¸»è¦è®¨è®º**å•å‘æ•°æ®åŒæ­¥**æ¨¡å‹ï¼Œå³

- ä¸€ä¸ªç¯å¢ƒè´Ÿè´£è®¡ç®—å¹¶æ›´æ–°æ•°æ®ï¼Œå†æŠŠå˜åŒ–åçš„æ•°æ®åŒæ­¥åˆ°å…¶ä»–ç¯å¢ƒä¸­ï¼›
- å…¶ä»–ç¯å¢ƒå¦‚æœéœ€è¦æ›´æ–°æ•°æ®ï¼Œä¸èƒ½ç›´æ¥æ›´æ–°å½“å‰ç¯å¢ƒå†…éƒ¨çš„æ•°æ®ï¼Œè€Œè¦é€šçŸ¥ç»´æŠ¤æ•°æ®çš„ç¯å¢ƒï¼Œç­‰å…¶æ›´æ–°åå†åŒæ­¥åˆ°å…¶ä»–ç¯å¢ƒï¼ˆåŒ…æ‹¬å½“å‰ç¯å¢ƒï¼‰ä¸­ã€‚

è¿™ç§æ¨¡å‹æ¯”è¾ƒç®€å• â€”â€”

- ä¼˜åŠ¿åœ¨äºï¼šç»“æ„æ¸…æ™°ä¸æ˜“å‡ºé”™ã€æ”¯æŒéšæ„åˆ›å»ºæˆ–é”€æ¯ä¸ç»´æŠ¤æ•°æ®çš„ç¯å¢ƒã€ä¸ç»´æŠ¤æ•°æ®çš„ç¯å¢ƒå¯ä»¥å¾ˆå®¹æ˜“çš„ä»å¼‚å¸¸ä¸­æ¢å¤ï¼›
- ä¸è¶³åœ¨äºï¼šå¦‚æœç»´æŠ¤æ•°æ®çš„ç¯å¢ƒæŸåï¼Œé‚£ä¹ˆæ‰€æœ‰ç¯å¢ƒéƒ½æ— æ³•ç»§ç»­å·¥ä½œï¼ˆä¾‹å¦‚ä¸»è¿›ç¨‹å´©æºƒåï¼Œè½¯ä»¶ä¹Ÿä¼šéšä¹‹å´©æºƒï¼‰ã€‚

è¿™ç§æ¨¡å‹çš„åŸºæœ¬æ•°æ®åŒæ­¥æ–¹å¼ä¸€èˆ¬æœ‰ä¸¤ç§ï¼š

1. ä¸ç»´æŠ¤æ•°æ®çš„ç¯å¢ƒ ä» ç»´æŠ¤æ•°æ®çš„ç¯å¢ƒ **æ‹‰å–å½“å‰çŠ¶æ€**ï¼ˆç”±äºçŠ¶æ€å¯èƒ½éšæ—¶å˜åŒ–ã€å¼‚æ­¥æ“ä½œä¼šæœ‰å»¶è¿Ÿï¼Œå½“å‰æ—¶åˆ»æ‹¿åˆ°çš„çŠ¶æ€ä¸ä¸€å®šæ˜¯æœ€æ–°çš„å®æ—¶çŠ¶æ€ï¼‰ï¼›
2. ä¸ç»´æŠ¤æ•°æ®çš„ç¯å¢ƒ **ç›‘å¬çŠ¶æ€å˜åŒ–**ï¼›ç­‰åˆ°çŠ¶æ€å˜åŒ–æ—¶ï¼Œç»´æŠ¤æ•°æ®çš„ç¯å¢ƒ å‘ ä¸ç»´æŠ¤æ•°æ®çš„ç¯å¢ƒ **æ¨é€çŠ¶æ€å˜åŒ–**ã€‚

## å¸¸è§è¯¯ç”¨ 1ï¼šåªæ‹‰å–ä¸ç›‘å¬

åšæ³•ï¼šåœ¨æ–°ç¯å¢ƒåˆå§‹åŒ–æ—¶ï¼Œä»…æ‹‰å–ä¸€æ¬¡æ•°æ®ã€‚

``` js
function init() {
  data = GetDataFromMainWorld();
}
```

ç¼ºé™·ï¼šå¦‚æœæ•°æ®åœ¨ **é¦–æ¬¡æ‹‰å–å** æ›´æ–°ï¼Œå½“å‰ç¯å¢ƒå°±ä¼šæ°¸è¿œéƒ½æ‹¿åˆ°**è¿‡æœŸæ•°æ®**ã€‚

``` js
init();  // 1. pull data from main world
// 2. main world update data (this world not update data)
someWhereUse(data);  // 3. this world use out-of-date data
```

## å¸¸è§è¯¯ç”¨ 2ï¼šåªç›‘å¬ä¸æ‹‰å–

åšæ³•ï¼šåœ¨æ–°ç¯å¢ƒåˆå§‹åŒ–æ—¶ï¼Œç›‘å¬æ¨é€å†æ›´æ–°æ•°æ®ã€‚

``` js
function init() {
  mainWorld.listenDataChanged(newData => data = newData);
}
```

ç¼ºé™·ï¼šå¦‚æœæ•°æ®åœ¨ **é¦–æ¬¡æ¨é€å‰** ä½¿ç”¨ï¼Œå½“å‰ç¯å¢ƒå°±ä¼šå…ˆæ‹¿åˆ°ä¸€æ¬¡**æœªåˆå§‹åŒ–æ•°æ®**ã€‚

``` js
init();  // 1. subscribe data changed event
someWhereUse(data);  // 2. this world use uninitialized data
// 3. main world update data (too late, this world update data now)
```

## å¸¸è§è¯¯ç”¨ 3ï¼šå…ˆæ‹‰å–å†ç›‘å¬

åšæ³•ï¼šåœ¨æ–°ç¯å¢ƒåˆå§‹åŒ–æ—¶ï¼Œå…ˆæ‹‰å–ä¸€æ¬¡æ•°æ®ï¼Œå†ç›‘å¬æ•°æ®æ›´æ–°çš„æ¨é€ã€‚

``` js
function init() {
  data = GetDataFromMainWorld();
  mainWorld.listenDataChanged(newData => data = newData);
}
```

è¿™ä¸ªç”¨æ³•çœ‹ä¼¼æ²¡æœ‰é—®é¢˜ï¼Œå®åˆ™ä¹Ÿæœ‰ç¼ºé™· ğŸ’€ğŸ’€ğŸ’€ â€”â€”

ç¼ºé™·ï¼šå¦‚æœæ•°æ®æ°å¥½åœ¨ **é¦–æ¬¡æ‹‰å–å**ã€**ç›‘å¬æ¨é€å‰** å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå½“å‰ç¯å¢ƒåœ¨æ”¶åˆ°é¦–æ¬¡æ¨é€å‰ï¼Œå°±ä¼šä¸€ç›´æ‹¿åˆ°**è¿‡æœŸæ•°æ®**ã€‚

``` js
init();  // 1. pull data from main world
         // 2. main world update data (too early, this world not update data)
         // 3. subscribe data changed event
someWhereUse(data);  // 4. this world use out-of-date data
```

## æ­£ç¡®ç”¨æ³•ï¼šå…ˆç›‘å¬å†æ‹‰å–

åšæ³•ï¼šåœ¨æ–°ç¯å¢ƒåˆå§‹åŒ–æ—¶ï¼Œå…ˆç›‘å¬æ•°æ®æ›´æ–°çš„æ¨é€ï¼Œå†æ‹‰å–åˆå§‹æ•°æ®ã€‚

``` js
function init() {
  mainWorld.listenDataChanged(newData => data = newData);
  data = GetDataFromMainWorld();
}
```

ä¼˜åŠ¿ï¼šå¯ä»¥ä¿è¯å½“å‰ç¯å¢ƒæ€»æ˜¯æ‹¿åˆ°**æ­£ç¡®æ•°æ®**ï¼ˆä½†è¿˜éœ€è¦ç¡®ä¿ `init` å†…éƒ¨ä¸ä¼šåœ¨æ‹‰å–åˆå§‹æ•°æ®å‰ä½¿ç”¨æ•°æ®ï¼‰ã€‚

``` js
// Good case:
init();  // 1. subscribe data changed event
         // 2. pull data from main world
someWhereUse(data);  // 3. this world always use valid fresh data
```

## å†™åœ¨æœ€å

å•å‘æ•°æ®åŒæ­¥çœ‹ä¼¼ç®€å•ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­å®¹æ˜“å› ç–å¿½å¯¼è‡´çŠ¶æ€ä¸åŒæ­¥ï¼›è€Œä¸”ä¸€æ—¦å‡ºé—®é¢˜ï¼Œæ’æŸ¥èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼ˆæ—¶åºé—®é¢˜ä¸å¥½å¤ç°ï¼‰ã€‚

æ‰€ä»¥æœ€å¥½èƒ½åœ¨ç¼–ç æ—¶ä½¿ç”¨æ­£ç¡®ç”¨æ³•ï¼Œé¿å…å‡ºç°çŠ¶æ€é”™è¯¯ã€‚

å¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œ**æ¬¢è¿äº¤æµ**ã€‚ğŸ˜„

Delivered under MIT License &copy; 2024, BOT Man
